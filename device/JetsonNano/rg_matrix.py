import Jetson.GPIO as GPIO
import time
'''
    TM1640 driver and demo, ported from Arduino
'''
alphabet = [
  [0x7F, 0x09, 0x19, 0x29, 0x46, 0x00, 0x00, 0x00, 0x7F, 0x09, 0x19, 0x29, 0x46, 0x00, 0x00, 0x00],
  [0x00, 0x42, 0x7F, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x42, 0x7F, 0x40, 0x00, 0x00, 0x00, 0x00],
  [0x42, 0x61, 0x51, 0x49, 0x46, 0x00, 0x00, 0x00, 0x42, 0x61, 0x51, 0x49, 0x46, 0x00, 0x00, 0x00],
  [0x22, 0x41, 0x49, 0x49, 0x36, 0x00, 0x00, 0x00, 0x22, 0x41, 0x49, 0x49, 0x36, 0x00, 0x00, 0x00],

  [0x18, 0x14, 0x12, 0x7F, 0x10, 0x00, 0x00, 0x00, 0x18, 0x14, 0x12, 0x7F, 0x10, 0x00, 0x00, 0x00],
  [0x4F, 0x49, 0x49, 0x49, 0x31, 0x00, 0x00, 0x00, 0x4F, 0x49, 0x49, 0x49, 0x31, 0x00, 0x00, 0x00],
  [0x3E, 0x49, 0x49, 0x49, 0x32, 0x00, 0x00, 0x00, 0x3E, 0x49, 0x49, 0x49, 0x32, 0x00, 0x00, 0x00],
  [0x01, 0x01, 0x71, 0x09, 0x07, 0x00, 0x00, 0x00, 0x01, 0x01, 0x71, 0x09, 0x07, 0x00, 0x00, 0x00],

  [0x36, 0x49, 0x49, 0x49, 0x36, 0x00, 0x00, 0x00, 0x36, 0x49, 0x49, 0x49, 0x36, 0x00, 0x00, 0x00],
  [0x26, 0x49, 0x49, 0x49, 0x3E, 0x00, 0x00, 0x00, 0x26, 0x49, 0x49, 0x49, 0x3E, 0x00, 0x00, 0x00],
  [0x7F, 0x04, 0x08, 0x10, 0x7F, 0x00, 0x00, 0x00, 0x7F, 0x04, 0x08, 0x10, 0x7F, 0x00, 0x00, 0x00],
  [0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff]]

din=13
clk=11

def start():
    GPIO.output(clk, GPIO.HIGH)
    GPIO.output(din, GPIO.HIGH)
    GPIO.output(din, GPIO.LOW)
    GPIO.output(clk, GPIO.LOW)
def stop():
    GPIO.output(clk, GPIO.HIGH)
    GPIO.output(din, GPIO.LOW)
    GPIO.output(din, GPIO.HIGH)
def write_byte(byte):
    GPIO.output(clk, GPIO.LOW)
    for i in range(8):
        if byte & 0x01 == 0x01:
            GPIO.output(din, GPIO.HIGH)
        else:
            GPIO.output(din, GPIO.LOW)
        GPIO.output(clk, GPIO.HIGH)
        GPIO.output(clk, GPIO.LOW)
        byte>>=1

def cmd(byte):
    start()
    write_byte(byte)
    stop()
def write_block(idx):
    start()
    write_byte(0xc0)
    for i in range(16):
        write_byte(alphabet[idx][i])
    stop()

def init():
    GPIO.setmode(GPIO.BOARD)
    GPIO.setup(din, GPIO.OUT, initial=GPIO.HIGH)
    GPIO.setup(clk, GPIO.OUT, initial=GPIO.HIGH)
    cmd(0x40)
    cmd(0x8c)
init()

for i in range(12):
    write_block(i)
    time.sleep(0.3)

GPIO.cleanup()
